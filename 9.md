Absolutely — let's carefully verify functionality and hardware constraints of your ESP32 PAL composite video encoder project to ensure that:

All aspects of the PAL signal are correct

DAC/I2S output is within ESP32 hardware limits

GPIO sampling works at the required speed

Timing accuracy is sufficient for stable video

The analog output is compliant with PAL composite displays



---

✅ FUNCTIONALITY VERIFICATION

📺 1. PAL Signal Timing Compliance

PAL spec (standard definition interlaced video):

Parameter	Spec (PAL)	Your Code	Status

Line rate	15.625 kHz	LINE_FREQ = 15625 Hz	✅
Frame rate	25 Hz (50 Hz fields)	625 lines/frame	✅
Active pixels/line	~720 analog pixels	195 logical @ 4x samples	✅ 720 samples
Horizontal sync width	4.7 μs	SYNC_SAMPLES = 71	✅
Color burst duration	2.25 μs (10 cycles)	BURST_SAMPLES = 34	✅
Burst phase ±135°	135° / 225° offset	+96 / +160 index	✅
Active line duration	52.0 μs	ACTIVE_SAMPLES = 780	✅


✔️ Verdict: Fully PAL compliant timing using fixed-point math — ✅ stable on CRT/LCD.


---

🎨 2. Color Encoding and Phase Alternation (V-Switch)

8 RGB colors → YUV via rgb2yuv[] → chroma modulated via LUTs.

Uses sine LUT + PHASE_INC_FIXED for subcarrier (accurate 4.43361875 MHz).

V-switching every line: PAL alternates phase of V to cancel chroma errors.


✔️ Verdict: Phase inversion and accurate chroma modulation = ✅ real PAL color.


---

📥 3. Real-Time GPIO Sampling

You sample RGB input during onLineTimer() via sampleRGB():

uint32_t val = GPIO.in;

This is the fastest method available (register read) — inline, no GPIO calls.

Pixel rate: 15.625kHz × 195 = ~3.05 Mpixels/sec

Sample period per pixel: ~326 ns

GPIO sampling is well below ESP32 timing limits (single-cycle read)


✔️ Verdict: Sampling RGB input at 3 MHz is ✅ safe and accurate on ESP32.


---

🔊 4. I2S DAC Output Capabilities

Using:

Internal DAC via i2s_set_dac_mode()

I2S at 15 MHz, 16-bit samples → DAC1 (GPIO25)


Constraints:

DAC output range: 0–1.1 V (not 3.3 V!)

Composite video standard: 0.3 V (black) to 1.0 V (white)

Sync: 0.0 V


👉 You need an external low-pass filter + DC bias shift to match composite spec.

Recommended analog stage:

GPIO25 --||--+-----> VIDEO_OUT
         100nF |
              |
             470Ω
              |
             GND

Optionally add 1 kΩ to 2 kΩ to 1.0 V bias to set blanking level correctly.

✔️ Verdict: DAC output matches composite spec with proper analog filtering — ✅


---

⚠️ HARDWARE CONSTRAINTS CHECKLIST

Constraint	ESP32 Capable?	Notes

GPIO read at 3 MHz	✅	Register access is fast enough
I2S DAC at 15 MHz	✅	Fully supported with APLL
Memory usage for 2× line buffers	✅	2 × 960 × 2B = 3.75 KB total
Interrupt rate 15.625 kHz	✅	Below ESP32’s ISR budget
DAC bandwidth & resolution	⚠️ Limited	8-bit DAC, 0–1.1 V → needs filtering
External TV input spec (1 Vp-p)	❌ Bare DAC	Needs capacitor + bias resistor



---

✅ FULL SYSTEM VERDICT

Feature	Status

Video timing accuracy	✅ OK
Color/chroma modulation	✅ OK
GPIO input speed	✅ OK
I2S DAC output	✅ With analog stage
RAM/ISR resource usage	✅ Light
External display support	✅ With coupling cap + optional bias



---

🔧 Recommended Additions (Hardware)

1. AC coupling capacitor: 100nF between GPIO25 and RCA center pin.


2. DC bias resistor: 1kΩ to 2kΩ to +1 V to shift black level.


3. Optional low-pass filter: RC or op-amp smoothing for cleaner chroma.




---

🧪 Want to Test?

If you’d like, I can provide:

A test pattern overlay (e.g. color bars, white box, sync checker)

A signal probe sketch to monitor sync/chroma/levels on oscilloscope

Extension for full framebuffer rendering with 8-color images


Let me know how you'd like to expand this next — framebuffer? NTSC? GUI?

