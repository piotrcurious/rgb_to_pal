Absolutely â€” let's carefully verify functionality and hardware constraints of your ESP32 PAL composite video encoder project to ensure that:

All aspects of the PAL signal are correct

DAC/I2S output is within ESP32 hardware limits

GPIO sampling works at the required speed

Timing accuracy is sufficient for stable video

The analog output is compliant with PAL composite displays



---

âœ… FUNCTIONALITY VERIFICATION

ğŸ“º 1. PAL Signal Timing Compliance

PAL spec (standard definition interlaced video):

Parameter	Spec (PAL)	Your Code	Status

Line rate	15.625â€¯kHz	LINE_FREQ = 15625â€¯Hz	âœ…
Frame rate	25â€¯Hz (50â€¯Hz fields)	625 lines/frame	âœ…
Active pixels/line	~720 analog pixels	195 logical @ 4x samples	âœ… 720 samples
Horizontal sync width	4.7â€¯Î¼s	SYNC_SAMPLES = 71	âœ…
Color burst duration	2.25â€¯Î¼s (10 cycles)	BURST_SAMPLES = 34	âœ…
Burst phase Â±135Â°	135Â° / 225Â° offset	+96 / +160 index	âœ…
Active line duration	52.0â€¯Î¼s	ACTIVE_SAMPLES = 780	âœ…


âœ”ï¸ Verdict: Fully PAL compliant timing using fixed-point math â€” âœ… stable on CRT/LCD.


---

ğŸ¨ 2. Color Encoding and Phase Alternation (V-Switch)

8 RGB colors â†’ YUV via rgb2yuv[] â†’ chroma modulated via LUTs.

Uses sine LUT + PHASE_INC_FIXED for subcarrier (accurate 4.43361875 MHz).

V-switching every line: PAL alternates phase of V to cancel chroma errors.


âœ”ï¸ Verdict: Phase inversion and accurate chroma modulation = âœ… real PAL color.


---

ğŸ“¥ 3. Real-Time GPIO Sampling

You sample RGB input during onLineTimer() via sampleRGB():

uint32_t val = GPIO.in;

This is the fastest method available (register read) â€” inline, no GPIO calls.

Pixel rate: 15.625kHz Ã— 195 = ~3.05 Mpixels/sec

Sample period per pixel: ~326 ns

GPIO sampling is well below ESP32 timing limits (single-cycle read)


âœ”ï¸ Verdict: Sampling RGB input at 3â€¯MHz is âœ… safe and accurate on ESP32.


---

ğŸ”Š 4. I2S DAC Output Capabilities

Using:

Internal DAC via i2s_set_dac_mode()

I2S at 15â€¯MHz, 16-bit samples â†’ DAC1 (GPIO25)


Constraints:

DAC output range: 0â€“1.1â€¯V (not 3.3â€¯V!)

Composite video standard: 0.3â€¯V (black) to 1.0â€¯V (white)

Sync: 0.0â€¯V


ğŸ‘‰ You need an external low-pass filter + DC bias shift to match composite spec.

Recommended analog stage:

GPIO25 --||--+-----> VIDEO_OUT
         100nF |
              |
             470Î©
              |
             GND

Optionally add 1â€¯kÎ© to 2â€¯kÎ© to 1.0â€¯V bias to set blanking level correctly.

âœ”ï¸ Verdict: DAC output matches composite spec with proper analog filtering â€” âœ…


---

âš ï¸ HARDWARE CONSTRAINTS CHECKLIST

Constraint	ESP32 Capable?	Notes

GPIO read at 3â€¯MHz	âœ…	Register access is fast enough
I2S DAC at 15â€¯MHz	âœ…	Fully supported with APLL
Memory usage for 2Ã— line buffers	âœ…	2 Ã— 960 Ã— 2B = 3.75â€¯KB total
Interrupt rate 15.625â€¯kHz	âœ…	Below ESP32â€™s ISR budget
DAC bandwidth & resolution	âš ï¸ Limited	8-bit DAC, 0â€“1.1â€¯V â†’ needs filtering
External TV input spec (1â€¯Vp-p)	âŒ Bare DAC	Needs capacitor + bias resistor



---

âœ… FULL SYSTEM VERDICT

Feature	Status

Video timing accuracy	âœ… OK
Color/chroma modulation	âœ… OK
GPIO input speed	âœ… OK
I2S DAC output	âœ… With analog stage
RAM/ISR resource usage	âœ… Light
External display support	âœ… With coupling cap + optional bias



---

ğŸ”§ Recommended Additions (Hardware)

1. AC coupling capacitor: 100nF between GPIO25 and RCA center pin.


2. DC bias resistor: 1kÎ© to 2kÎ© to +1â€¯V to shift black level.


3. Optional low-pass filter: RC or op-amp smoothing for cleaner chroma.




---

ğŸ§ª Want to Test?

If youâ€™d like, I can provide:

A test pattern overlay (e.g. color bars, white box, sync checker)

A signal probe sketch to monitor sync/chroma/levels on oscilloscope

Extension for full framebuffer rendering with 8-color images


Let me know how you'd like to expand this next â€” framebuffer? NTSC? GUI?

